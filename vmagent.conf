# vmagent Configuration for Scraping Redis Standalone Metrics
global:
  scrape_interval: 15s  # Adjust the scrape interval as needed

scrape_configs:
  - job_name: 'redis-standalone-metrics'
    kubernetes_sd_configs:
      - role: pod
        namespaces:
          names:
            - redis-standalone  # Namespace where Redis pods are deployed
    metrics_path: /metrics  # Path where Redis Exporter exposes metrics
    scheme: http  # Use http; switch to https if your exporter requires it
    relabel_configs:
      # Keep only Pods with the specific labels
      - source_labels:
          - __meta_kubernetes_pod_label_app_kubernetes_io_name
          - __meta_kubernetes_pod_label_app_kubernetes_io_instance
          - __meta_kubernetes_pod_label_app_kubernetes_io_component
        action: keep
        regex: redis;redis-standalone;database  # Match Pods with name=redis, instance=redis-standalone, component=database

      # Set the target address to Pod IP and Exporter port
      - source_labels: [__meta_kubernetes_pod_ip]
        target_label: __address__
        replacement: $1:9121  # Replace with Pod IP and Exporter port

      # Add Redis version as a label
      - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_redis_version]
        target_label: redis_version

      # Add Redis Exporter version as a label
      - source_labels: [__meta_kubernetes_pod_label_app_kubernetes_io_redis_exporter_version]
        target_label: redis_exporter_version

      # Optionally, add Kubernetes namespace as a label
      - source_labels: [__meta_kubernetes_namespace]
        target_label: kubernetes_namespace

      # Optionally, add Pod name as a label
      - source_labels: [__meta_kubernetes_pod_name]
        target_label: kubernetes_pod_name

      # Optionally, add Pod index as a label
      - source_labels: [__meta_kubernetes_pod_label_apps_kubernetes_io_pod_index]
        target_label: redis_pod_index

      # Optionally, add StatefulSet revision as a label
      - source_labels: [__meta_kubernetes_pod_label_controller_revision_hash]
        target_label: controller_revision_hash

      # Optionally, add StatefulSet pod name as a label
      - source_labels: [__meta_kubernetes_pod_label_statefulset_kubernetes_io_pod_name]
        target_label: statefulset_pod_name
